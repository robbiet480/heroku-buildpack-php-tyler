# setting worker_processes to CPU core count
worker_processes      1;
daemon off;

events {
  worker_connections  1024;
}

http {
  include             mime.types;
  default_type        application/octet-stream;
  sendfile            on;
  keepalive_timeout   65;
  gzip			on;
  access_log		off;
  proxy_max_temp_file_size	0;
  #fastcgi_max_temp_file_size	0;

  server {
    listen <%= ENV['PORT'] %>;

    server_name _;

    root /app/deploy;

    index index.php;

    #location /images {
    #rewrite ^/images/(.*) /images/dogspot/$1;
    #break;
    #}


    location / {
      if (!-e /$request_filename) {
        rewrite .* /runtime/startup.php last;
    }

    if ($uri = /) {
        rewrite .* /runtime/startup.php last;
      }
    }


    location ~ \.php$ {
      include fastcgi_params;

      fastcgi_pass unix:/tmp/php5-fpm.sock;
      fastcgi_index index.php;
      fastcgi_param SCRIPT_FILENAME /app/deploy/runtime/startup.php;
    }

  }
}